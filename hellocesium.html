<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <script src="CesiumUnminified/Cesium.js"></script>

    <style>
        @import url(CesiumUnminified/Widgets/widgets.css);

        html, body, #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;

        }
    </style>


</head>


<body>

    <div style="position: relative; top: 20px; left: 20px; width:100px;hight:150px; z-index:10;">
        <button id="btnDispPlane" type="button" style="position: relative; " onclick="DispPlaneMethon()">-操作选项-</button>
        <button id="btnFlyObj" type="button" style="position: relative; " onclick="funcFlyObj()">飞行路线演示</button>
        <button id="btnClearAll" type="button" style="position: relative; " onclick="funcClearObj()">清除所有对象</button>
        <button id="btnFlyObj2" type="button" style="position: relative; " onclick="funcFlyObj2()">沿线飞行</button>
        <button id="btnFlyGame" type="button" style="position: relative; " onclick="funcFlyGame()">模拟飞行</button>


    </div>

    <div id="cesiumContainer" style="position: absolute; top: 0; left: 0; height: 100%; z-index: 0;">     <!-- background-image: url(./SampleData/星云.jpg);  背景图片 -->



    </div>


    <script type="text/javascript">



        Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI1NTRlZmIzZC1mNGRlLTQ4MDYtOWRjOC1hNGQ4NjlmMmE4OGMiLCJpZCI6ODc1MjcsImlhdCI6MTY0OTM4OTU5OX0.CpHmD7yyQO122b7wKRANtzgeh18UxmVTmjsWsMB-Wdo";
        const viewer = new Cesium.Viewer("cesiumContainer",
            {
                animation: false,   //动画
                timeline: false,    //时间线控件
                scene3DOnly: true,      //仅显示3D地图，不显示平面地图选择
                baseLayerPicker: false,     //图层选择关闭
                navigationHelpButton: false,     //帮助按钮
                shouldAnimate: true,           // 当viewer开启后，启动动画
                infoBox: false,                      //显示图层信息
                shadows: false,               //显示阴影
                geocoder: true,//是否显示geocoder小器件，右上角查询按钮
                homeButton: true,//是否显示Home按钮
                sceneModePicker: false,//是否显示3D/2D选择器
                fullscreenButtion: true,//是否显示全屏按钮
                vrButton: false,              // VR 按钮是否显示
                selectionIndicator: false,//是否显示选取指示器组件
                orderIndependentTranslucency:false,    //设置渲染
                contextOptions: {
                    webgl: { alpha: true, },
                    requestWebg12: true,                     //开启该选项的前提条件是在支持WebGL 2.0的环境下，WebGL 2.0中通过多采样渲染缓冲对象（Multisampled RederBuffer），以在帧缓冲区的渲染缓冲对象上实现MSAA。
                },
                massSamples: 4                            //MSAA（multisampled antialiasing多重采样抗锯齿


            }
        );
        viewer._cesiumWidget._creditContainer.style.display = "none";  //去除水印
        viewer.scene.debugShowFramesPerSecond = true;                    //显示帧率

        /*
        viewer.scene.skyBox.show = false;               //关闭 天空背景盒
        viewer.scene.backgroundColor = new Cesium.Color(0, 0, 0, 0);    //设置背景透明

        viewer.scene.skyBox = new Cesium.SkyBox({
            source: {
                positiveX: "SampleData/星云.jpg",
                negativeX: "SampleData/星云.jpg",
                positiveY: "SampleData/星云.jpg",
                negativeY: "SampleData/星云.jpg",
                positiveZ: "SampleData/星云.jpg",
                negativeZ: "SampleData/星云.jpg"
            }
        });

        viewer.scene.skyBox.show = true;

        viewer.scene.sun.show = true;
        viewer.scene.moon.show = true;
        */


        //删除默认影像图层
        viewer.imageryLayers.remove(viewer.imageryLayers.get(0));


        //定义 百度 地图 ImageryProvider
        BaiduImageryProvider = function (options) {
            this._errorEvent = new Cesium.Event();
            this._tileWidth = 256;
            this._tileHeight = 256;
            this._maximumLevel = 18;
            this._minimumLevel = 1;
            var southwestInMeters = new Cesium.Cartesian2(-33554054, -33746824);
            var northeastInMeters = new Cesium.Cartesian2(33554054, 33746824);
            this._tilingScheme = new Cesium.WebMercatorTilingScheme({
                rectangleSouthwestInMeters: southwestInMeters,
                rectangleNortheastInMeters: northeastInMeters
            });
            this._rectangle = this._tilingScheme.rectangle;
            var resource = Cesium.Resource.createIfNeeded(options.url);
            this._resource = resource;
            this._tileDiscardPolicy = undefined;
            this._credit = undefined;
            this._readyPromise = undefined;
        };

        Object.defineProperties(BaiduImageryProvider.prototype, {
            url: {
                get: function () {
                    return this._resource.url;
                }
            },
            proxy: {
                get: function () {
                    return this._resource.proxy;
                }
            },
            tileWidth: {
                get: function () {
                    if (!this.ready) {
                        throw new Cesium.DeveloperError('tileWidth must not be called before the imagery provider is ready.');
                    }
                    return this._tileWidth;
                }
            },

            tileHeight: {
                get: function () {
                    if (!this.ready) {
                        throw new Cesium.DeveloperError('tileHeight must not be called before the imagery provider is ready.');
                    }
                    return this._tileHeight;
                }
            },

            maximumLevel: {
                get: function () {
                    if (!this.ready) {
                        throw new Cesium.DeveloperError('maximumLevel must not be called before the imagery provider is ready.');
                    }
                    return this._maximumLevel;
                }
            },

            minimumLevel: {
                get: function () {
                    if (!this.ready) {
                        throw new Cesium.DeveloperError('minimumLevel must not be called before the imagery provider is ready.');
                    }
                    return this._minimumLevel;
                }
            },

            tilingScheme: {
                get: function () {
                    if (!this.ready) {
                        throw new Cesium.DeveloperError('tilingScheme must not be called before the imagery provider is ready.');
                    }
                    return this._tilingScheme;
                }
            },

            tileDiscardPolicy: {
                get: function () {
                    if (!this.ready) {
                        throw new Cesium.DeveloperError('tileDiscardPolicy must not be called before the imagery provider is ready.');
                    }
                    return this._tileDiscardPolicy;
                }
            },

            rectangle: {
                get: function () {
                    if (!this.ready) {
                        throw new Cesium.DeveloperError('rectangle must not be called before the imagery provider is ready.');
                    }
                    return this._rectangle;
                }
            },

            errorEvent: {
                get: function () {
                    return this._errorEvent;
                }
            },
            ready: {
                get: function () {
                    return this._resource;
                }
            },
            readyPromise: {
                get: function () {
                    return this._readyPromise;
                }
            },
            credit: {
                get: function () {
                    if (!this.ready) {
                        throw new Cesium.DeveloperError('credit must not be called before the imagery provider is ready.');
                    }
                    return this._credit;
                }
            },
        });


        BaiduImageryProvider.prototype.requestImage = function (x, y, level, request) {
            var r = this._tilingScheme.getNumberOfXTilesAtLevel(level);
            var c = this._tilingScheme.getNumberOfYTilesAtLevel(level);
            var s = this.url.replace("{x}", x - r / 2).replace("{y}", c / 2 - y - 1).replace("{z}", level).replace("{s}", Math.floor(10 * Math.random()));
            return Cesium.ImageryProvider.loadImage(this, s);
        };



        /*
        //加载Cesium Ion 的影像服务 , 加载Cesium Ion中asset ID为 3812 的影像服务
        const ionImageProvider_3812 = new Cesium.IonImageryProvider({ assetId:3812});

        // 将影像数据源组织为影像图层
        const blackMarbleLayer = new Cesium.ImageryLayer(ioImageProvider_3812,
            {
                alpha: 0.5,
                brightness:2.0
            });

        viewer.imageryLayers.add(blackMarbleLayer);
        */



        //增加 Esri ArcGis 影像底图

        viewer.imageryLayers.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({
            url: "https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/"
            // http://server.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer
            // url: "http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"   //Cesium加载ArcGIS街道图
        })
        );



        //Cesium加载ArcGIS蓝色图
        /*
        viewer.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({
            url: "https://map.geoq.cn/arcgis/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}"
            })
        );
        */


        //Cesium 加载 baidu 百度地图
        /*
        viewer.imageryLayers.addImageryProvider(new BaiduImageryProvider({
            url: "http://online{s}.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles=pl&scaler=1&p=1"

            })
        );
        */

        //加载高德地图
        /*  // 影像
        viewer.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider(
            {
                url: "http://webst01.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}"
            }
        ));
        */
        /*
        //路网
        viewer.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider(
            {
                //url: "http://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",
                url: "http://webst01.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8"
                //tilingScheme: new Cesium.WebMercatorTilingScheme()
            }
        )
        );
        */

        /*
        矢量地图带注记：https://webrd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}
        矢量地图不带注记：http://wprd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&x={x}&y={y}&z={z}&scl=1&ltype=3
        影像不带注记：http://webst0{1-4}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}
        道路带注记：http://webst0{1-4}.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8
        道路不带注记：http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scl=1&style=8&ltype=11
        矢量带注记 http://wprd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&x={x}&y={y}&z={z}

         * /


         //google 地图数据源
        /*
        viewer.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({
             //url: "http://www.google.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}",
             url:"http://mt1.google.cn/vt/lyrs=s&hl=zh-CN&x={x}&y={y}&z={z}&s=Gali"
            })
         );
        */


        //加载矢量数据源  CZML
        //viewer.dataSources.add(Cesium.CzmlDataSource.load("SampleData/Vehicle.czml"));




        //开启cesium全球地形
        /*
        viewer.terrainProvider = Cesium.createWorldTerrain(
            {
                requestWaterMask: true,      //水面数据
                requestVertexNormals:false     //光照数据
            }
        );
        */


        //打开深度检测，在地形以下的对象不可见
        //viewer.scene.globe.depthTestAgainstTerrain = true;

        //开启全球光照
        //viewer.scene.globe.enableLighting = true;

        /*
        viewer.camera.setView({
                destination: new Cesium.Cartesian3(0,0,0),
                orientation: {
                    heading: Cesium.Math.toRadians(90.0),
                    pitch: Cesium.Math.toRadians(-90),
                    roll:45.0
                }
            }
        );
        */


        // 创建相机初始位置和朝向，fromDegrees 从经纬度，到球体弧度，角度
        var initialPosition = new Cesium.Cartesian3.fromDegrees(-73.998114468289017509, 40.674512895646692812, 2631.082799425431);
        var initialOrientation = new Cesium.HeadingPitchRoll.fromDegrees(7.1077496389876024807, -31.987223091598949054, 0.025883251314954971306);     //转换为 度数

        var homeCameraView = {
            destination: initialPosition,
            orientation: {
                heading: initialOrientation.heading,
                pitch: initialOrientation.pitch,
                roll: initialOrientation.roll

            }
        };
        console.log(initialOrientation.heading, '航向');
        console.log(initialOrientation.pitch, '推进度数');
        console.log(initialOrientation.roll, '旋转角度');


        // 设置视图
        viewer.scene.camera.setView(homeCameraView);

        //相机飞行动画
        homeCameraView.duration = 2.5;                      //动画持续时间
        homeCameraView.maximumHeight = 5000;                       //最大高度
        homeCameraView.pitchAdjustHeight = 3000;                  //推动调整高度
        homeCameraView.endTransform = Cesium.Matrix4.IDENTITY;

        //覆盖默认 home 按钮功能函数
        viewer.homeButton.viewModel.command.beforeExecute.addEventListener(function (e) {
            e.cancel = true;
            viewer.scene.camera.flyTo(homeCameraView);
        }
        );

        //viewer的画布
        //var handler = new Cesium.ScreenSpaceEventHandler(viewer.canvas);
        // 获得椭球坐标
        //获取鼠标经纬度喝视角高度
        var longitude_show = document.getElementById('longitude_show');   //经度
        var latitude_show = document.getElementById('latitude_show');     //纬度
        var altitude_show = document.getElementById('altitude_show');     //海拔，高程
        var elevation_show = document.getElementById('elevation_show');    //海拔高度，提升，立体面

        var canvas = viewer.scene.canvas;

        //事件实现
        //替换双击左键事件处理
        var ellipsoid = viewer.scene.globe.ellipsoid;
        var handler = new Cesium.ScreenSpaceEventHandler(canvas);

        handler.setInputAction(function (event) {

            //捕获椭球体，将笛卡尔二维平面坐标转换为椭球体的笛卡尔三维坐标，返回球体表面的点
            //获取 笛卡尔二维平面坐标,笛卡尔（直角）坐标 – 当用来表示位置的时候，这个坐标指在地固坐标系（Earth fixed-frame (ECEF)）下，相对地球中心的坐标位置，单位是米
            var cartesian = viewer.camera.pickEllipsoid(event.position, viewer.scene.globe.ellipsoid);
            if (cartesian) {
                //将笛卡尔二维平面坐标,笛卡尔（直角）坐标转为椭球体的笛卡尔三维坐标（弧度），地图坐标
                var cartographic = viewer.scene.globe.ellipsoid.cartesianToCartographic(cartesian);

                //将椭球体的笛卡尔三维坐标（弧度）转为 转为经纬度（弧度）和高度(WGS84地球高程)描述的三维坐标十进制数
                var log_String = Cesium.Math.toDegrees(cartographic.longitude).toFixed(4);
                var lat_String = Cesium.Math.toDegrees(cartographic.latitude).toFixed(4);
                var alti_String = (viewer.camera.positionCartographic.height).toFixed(2);

                console.log(log_String, '经度');
                console.log(lat_String, '纬度');
                console.log(alti_String, '视角高度');

                // createPoint(cartesian);      //在点击位置添加一个点
                annotate(cartesian, log_String, lat_String, alti_String);          //在点击中位置创建一个注释文本

            }
        }
            , Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);



        /*
        function heightToZoom(height)
        {
            var A = 40487.57;
            var B = 0.00007096758;
            var C = 91610.74;
            var D = -40467.74;
            return Math.round(D + (A - D) / (1 + Math.pow(height / C, B)));
        }

        var height = Math.ceil(viewer.camera.positionCartographic.height);
        var zoom = heightToZoom(height);
        //console.log(zoom, 'zoom');
        */





        var entity = viewer.entities.add(
            {
                position: Cesium.Cartesian3.fromDegrees(108.3523, 22.80680),
                billboard: {
                    image: "SampleData/win11.png", // default: undefined
                    show: true, // default
                    pixelOffset: new Cesium.Cartesian2(0, 0), // default: (0, 0)
                    eyeOffset: new Cesium.Cartesian3(0.0, 0.0, 0.0), // default
                    horizontalOrigin: Cesium.HorizontalOrigin.CENTER, // default
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM, // default: CENTER
                    scale: 0.5, // default: 1.0
                    color: Cesium.Color.WHITE, // default: WHITE
                    rotation: Cesium.Math.PI_OVER_FOUR, // default: 0.0
                    alignedAxis: Cesium.Cartesian3.ZERO, // default
                    //width: 100, // default: undefined
                    //height: 100, // default: undefined
                    sizeInMeters: true
                }
            }
        );


        /*
        var entity = viewer.entities.add({
            position: Cesium.Cartesian3.fromDegrees(120.9677706, 30.7985748, 2.61),
            point: {
                color: Cesium.Color.RED,    //点位颜色
                pixelSize: 10                //像素点大小
            },
            label: {
                text: '测试名称',
                font: '14pt Source Han Sans CN',    //字体样式
                fillColor: Cesium.Color.BLACK,        //字体颜色
                backgroundColor: Cesium.Color.AQUA,    //背景颜色
                showBackground: true,                //是否显示背景颜色
                style: Cesium.LabelStyle.FILL,        //label样式
                outlineWidth: 2,
                verticalOrigin: Cesium.VerticalOrigin.CENTER,//垂直位置
                horizontalOrigin: Cesium.HorizontalOrigin.LEFT,//水平位置
                pixelOffset: new Cesium.Cartesian2(10, 0)            //偏移
            }
        });
        */

        //viewer.zoomTo(entity);    //居中到该点




        var annotations = viewer.scene.primitives.add(new Cesium.LabelCollection());

        //信息提示框
        function annotate(cartesian, log, lat, height) {
            createPoint(cartesian);

            annotations.add({
                show: true,
                position: cartesian,
                text:
                    ' 经度: ' + log + ' \u00B0 ' +         //  \u unicode 00B0  度数符号
                    '\n 纬度: ' + lat + ' \u00B0 ' +
                    '\n 高度: ' + height + '米',
                showBackground: true,
                font: '15px sans-serif',
                fillColor: Cesium.Color.WHITE,
                horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                disableDepthTestDistance: Number.POSITIVE_INFINITY

            });
        }

        //添加点
        function createPoint(worldPosition) {
            var point = viewer.entities.add({
                position: worldPosition,
                point: {
                    color: Cesium.Color.RED,
                    pixelSize: 6
                }
            });
            return point;
        }





        //定位到位置
        //var camera = viewer.scene.camera;
        /*
        camera.flyTo({
            //镜头的经纬度、高度。镜头默认情况下，在指定经纬高度俯视（pitch=-90）地球
            destination: Cesium.Cartesian3.fromDegrees(113.664761, 34.754152, 1000),
            orientation: {
                heading: Cesium.Math.toRadians(0),   //方向
                pitch: Cesium.Math.toRadians(-15),  //倾斜角度
                roll: Cesium.Math.toRadians(0)
            },
            duration: 3,    //动画持续时间
            //  complete: function(){}     //飞行完毕后执行的动作
            }
        );
        */

        //画线
        function createLine() {
            var line = viewer.entities.add({
                name: '南宁 line',
                polyline: {
                    positions: Cesium.Cartesian3.fromDegreesArray([108.3523, 22.80680, 103.8583, 1.2827, 151.2154, -33.8566]),
                    width: 5,
                    material: parent.Cesium.Color.RED,
                    clampToGround: true
                }
            })

        }

        //显示 3D 模型
        function createModel(url, x, y, height) {
            //viewer.entities.removeAll();

            position = Cesium.Cartesian3.fromDegrees(x, y, height);
            const heading = Cesium.Math.toRadians(180);
            const pitch = 0;
            const roll = 0;
            const hpr = new Cesium.HeadingPitchRoll(heading, pitch, roll);
            const orientation = Cesium.Transforms.headingPitchRollQuaternion(position, hpr);

            entity = viewer.entities.add({
                name: url,
                position: position,
                orientation: orientation,
                model: {
                    uri: url,
                    minimumPixelSize: 150,
                    maximumScale: 15000,
                },
            });
            //viewer.trackedEntity = entity;       //视图锁定条目对象
        }




        viewer.camera.setView({
            destination: new Cesium.Cartesian3.fromDegrees(103.8583, 1.2827, 600),
            orientation: {
                heading: Cesium.Math.toRadians(0),  //镜头朝向 ，九十度，即东向   Radians 角度 0度是正北,镜头顺时针旋转九十度，即东向
                pitch: Cesium.Math.toRadians(-75),   //镜头倾斜45度俯视，围绕Y轴旋转
                roll: 0.0                             //围绕X轴旋转
            }
        }
        );


        //覆盖默认 home 按钮功能函数

        viewer.homeButton.viewModel.command.beforeExecute.addEventListener(function (e) {
            e.cancel = true;
            //viewer.scene.camera.flyTo(homeCameraView);
            viewer.scene.camera.flyTo({
                //镜头的经纬度、高度。镜头默认情况下，在指定经纬高度俯视（pitch=-90）地球
                destination: Cesium.Cartesian3.fromDegrees(108.3503, 22.80660, 4000),
                orientation: {
                    heading: Cesium.Math.toRadians(0),   //方向  Radians 角度 0度是正北，90 为东方，顺时针转 90度为东方
                    pitch: Cesium.Math.toRadians(-80),  //倾斜角度  -90 ，镜头向下看， 天上是 90， 东方是 0
                    roll: Cesium.Math.toRadians(0.0)
                }
                //,
                //duration: 3    //动画持续时间
                // complete: function(){}     //飞行完毕后执行的动作

            }
            );

        }
        );



        /*
        //画矢量图
        var kmlOptions = {
            camera: viewer.scene.camera,
            canvas: viewer.scene.canvas,
            clampToGround: true
        };
        var geocachePromise = Cesium.KmlDataSource.load("SampleData/kml/bikeRide.kml", kmlOptions);

        geocachePromise.then(function (dataSource) {
            //把所有entities添加到viewer中显示
            viewer.dataSources.add(dataSource);

            // 获得entity列表
            var geocacheEntities = dataSource.entities.values;

            for (var i = 0; i < geocacheEntities.length; i++) {
                var entity = geocacheEntities[i];
                if (Cesium.defined(entity.billboard)) {
                    //设置 entity 样式,下对齐，垂直方向对着地表
                    entity.billboard.verticalOrigin = Cesium.VerticalOrigin.BOTTOM;
                    entity.lablel = undefined;    //去掉文字显示
                    //设置可见距离
                    entity.billboard.distanceDisplayCondition = new Cesium.DistanceDisplayCondition(100, 4000);
                    console.log(i);
                }
            }
            //Infobox的标题栏显示的是entity的name属性, 它的内容显示的是description属性（使用HTML文本显示）
            if (Cesium.defined(entity.billboard)) {

                // 计算经度和纬度（角度表示）
                var cartographicPosition = Cesium.Cartographic.fromCartesian(entity.position.getValue(Cesium.JulianDate.now()));
                var longitude = Cesium.Math.toDegrees(cartographicPosition.longitude);
                var latitude = Cesium.Math.toDegrees(cartographicPosition.latitude);
                // 修改描述信息
                var description = '<table class="cesium-infoBox-defaultTable cesium-infoBox-defaultTable-lighter"><tbody>' +
                    '<tr><th>' + "经度" + '</th><td>' + longitude.toFixed(5) + '</td></tr>' +
                    '<tr><th>' + "纬度" + '</th><td>' + latitude.toFixed(5) + '</td></tr>' +
                    '</tbody></table>';
                entity.description = description;
            }


        });
        */






        /*

        const options = [
            {
                text: "Aircraft",
                onselect: function () {
                    createModel(
                        "./SampleData/models/CesiumAir/Cesium_Air.glb",
                        5000.0
                    );
                },
            },
            {
                text: "Drone",
                onselect: function () {
                    createModel(
                        "./SampleData/models/CesiumDrone/CesiumDrone.glb",
                        150.0
                    );
                },
            },
            {
                text: "Ground Vehicle",
                onselect: function () {
                    createModel(
                        "./SampleData/models/GroundVehicle/GroundVehicle.glb",
                        0
                    );
                },
            },
            {
                text: "Hot Air Balloon",
                onselect: function () {
                    createModel(
                        "./SampleData/models/CesiumBalloon/CesiumBalloon.glb",
                        1000.0
                    );
                },
            },
            {
                text: "Milk Truck",
                onselect: function () {
                    createModel(
                        "./SampleData/models/CesiumMilkTruck/CesiumMilkTruck.glb",
                        0
                    );
                },
            },
            {
                text: "Skinned Character",
                onselect: function () {
                    createModel(
                        "./SampleData/models/CesiumMan/Cesium_Man.glb",
                        0
                    );
                },
            },
            {
                text: "Draco Compressed Model",
                onselect: function () {
                    createModel(
                        "./SampleData/models/DracoCompressed/CesiumMilkTruck.gltf",
                        0
                    );
                },
            },
            {
                text: "KTX2 Compressed Balloon",
                onselect: function () {
                    if (!Cesium.FeatureDetection.supportsBasis(viewer.scene)) {
                        window.alert(
                            "This browser does not support Basis Universal compressed textures"
                        );
                    }
                    createModel(
                        "./SampleData/models/CesiumBalloonKTX2/CesiumBalloonKTX2.glb",
                        1000.0
                    );
                },
            },
        ];
        */
        

        var marksIndex = 1;
        var pitchValue = -20;


        /** 相机视角飞行 开始 **/
        var marks = [
            { lng: 108.3580, lat: 22.7970, height: 8000, flytime: 5 },// height:相机高度(单位米) flytime:相机两个标注点飞行时间(单位秒)
            { lng: 103.8583, lat: 1.2827, height: 6000, flytime: 5 },
            { lng: 151.2154, lat: - 33.8566, height: 5000, flytime: 5 }
        ];// 地标集合 根据地标顺序来进行漫游


        function DispPlaneMethon() {

            //画线
            createLine();

            //画火焰
            viewer.entities.add(
                {
                    position: Cesium.Cartesian3.fromDegrees(151.2154, -33.8566),
                    billboard: {
                        image: "SampleData/fire.png", // default: undefined
                        show: true, // default
                        pixelOffset: new Cesium.Cartesian2(0, 0), // default: (0, 0)
                        eyeOffset: new Cesium.Cartesian3(0.0, 0.0, 0.0), // default
                        horizontalOrigin: Cesium.HorizontalOrigin.CENTER, // default
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM, // default: CENTER
                        scale: 3, // default: 1.0
                        color: Cesium.Color.WHITE, // default: WHITE
                        rotation: Cesium.Math.PI_OVER_FOUR, // default: 0.0
                        alignedAxis: Cesium.Cartesian3.ZERO, // default
                        width: 25, // default: undefined
                        height: 25 // default: undefined
                        //sizeInMeters: true
                    }
                }
            );

            //显示 3D 飞机
            createModel("./SampleData/models/CesiumAir/Cesium_Air.glb", 108.3603, 22.87460, 2000);
            createModel("./SampleData/models/CesiumAir/Cesium_Air.glb", 108.4503, 22.83660, 3000);
            createModel("./SampleData/models/CesiumAir/Cesium_Air.glb", 108.3833, 22.80260, 2500);
            createModel("./SampleData/models/CesiumAir/Cesium_Air.glb", 108.3003, 22.8160, 3500);
            createModel("./SampleData/models/CesiumAir/Cesium_Air.glb", 108.4003, 22.8860, 4000);

            viewer.camera.setView({
                destination: new Cesium.Cartesian3.fromDegrees(108.3581, 22.8059, 1000),
                orientation: {
                    heading: Cesium.Math.toRadians(0),  //镜头朝向 ，九十度，即东向   Radians 角度 0度是正北,镜头顺时针旋转九十度，即东向
                    pitch: Cesium.Math.toRadians(-75),   //镜头倾斜45度俯视，围绕Y轴旋转
                    roll: 0.0                             //围绕X轴旋转
                }
            }
            );
        }



        function funcFlyObj()
        {
            createModel("./SampleData/models/CesiumAir/Cesium_Air.glb", 108.3580, 22.8079, 1000);

            //画线
            createLine();

            viewer.camera.setView({
                destination: new Cesium.Cartesian3.fromDegrees(108.3581, 22.7970, 8000),
                orientation: {
                    heading: Cesium.Math.toRadians(0),  //镜头朝向 ，九十度，即东向   Radians 角度 0度是正北,镜头顺时针旋转九十度，即东向
                    pitch: Cesium.Math.toRadians(-75),   //镜头倾斜45度俯视，围绕Y轴旋转
                    roll: 0.0                             //围绕X轴旋转
                }
            }
            );
        }


        function funcClearObj() {
            viewer.entities.removeAll();
        }

        // 起始时间
        const start = Cesium.JulianDate.fromDate(new Date());
        // 结束时间
        const stop = Cesium.JulianDate.addSeconds(start, 10, new Cesium.JulianDate());

        

        // 设置飞行的时间到viewer的时钟里
        function setExtentTime(time) {
            var startTime = Cesium.JulianDate.fromDate(new Date());
            var stopTime = Cesium.JulianDate.addSeconds(startTime, 20, new Cesium.JulianDate());
            viewer.clock.startTime = startTime.clone();  // 开始时间
            viewer.clock.stopTime = stopTime.clone();     // 结速时间
            viewer.clock.currentTime = startTime.clone(); // 当前时间
            
            viewer.clock.multiplier = 500;       // 时间速率，数字越大时间过的越快

            // 循环执行,即为2，到达终止时间，重新从起点时间开始
            viewer.clock.clockRange = Cesium.ClockRange.CLAMPED; // 行为方式  LOOP_STOP 循环，CLAMPED  停止
            viewer.clock.clockStep = Cesium.ClockStep.SYSTEM_CLOCK; // 时钟设置为当前系统时间; 忽略所有其他设置。
            // 时间轴
            //Cesium.viewer.timeline.zoomTo(start,stop);
        }




        //SampledPositionProperty(referenceFrame, numberOfDerivatives)   //定义坐标系，加速度
        function computeFlight(source) {
               
            //飞行路径的位置
            let property = new Cesium.SampledPositionProperty();
            //添加飞机飞行路径
            for (let i = 0; i < source.length; i++) {
                let time = Cesium.JulianDate.addSeconds(start, source[i].flytime, new Cesium.JulianDate);
                let position = Cesium.Cartesian3.fromDegrees(source[i].lng, source[i].lat, source[i].height);
                // 添加位置，和时间对应
                property.addSample(time, position);
                console.log(position.x);
            }
            return property;
        }




        //飞行事件
        function flyExtent() {
            // 相机看点的角度，如果大于0那么则是从地底往上看，所以要为负值
            //var pitch = Cesium.Math.toRadians(pitchValue);

            // 设置飞行时间
            setExtentTime(marks[marksIndex].flytime);
            //var Exection = function TimeExecution() {

                for (let j = 0; j < marks.length; j++) {
                    let property = computeFlight(marks[j]);
                    console.log(property);

                    let planeModel = viewer.entities.add({
                        //与时间关联
                        availability: new Cesium.TimeIntervalCollection(new Cesium.TimeInterval({
                            start: start,
                            stop: stop
                        })),
                        position: property,

                        // 根据所提供的速度计算模型的朝向
                        orientation: new Cesium.VelocityOrientationProperty(property),
                        // 模型数据
                        model: {
                            uri: "./SampleData/models/CesiumAir/Cesium_Air.glb",
                            minimumPixelSize: 128
                        }
                    });
                }
               
                //移动相机
                /*
                viewer.scene.camera.setView({
                    destination: endPosition,
                    orientation: {
                        heading: heading,
                        pitch: pitch,
                    }
                });

                if (Cesium.JulianDate.compare(viewer.clock.currentTime, viewer.clock.stopTime) >= 0) {
                    viewer.clock.onTick.removeEventListener(Exection);
                    changeCameraHeading();
                }
                */
           // };

            //viewer.clock.onTick.addEventListener(Exection);
        }


        function dispBox() {
            var mybox = viewer.entities["mybox"];
            console.log(mybox.box.dimensions);
            mybox.box.dimensions = new Cesium.Cartesian3(1000.0, 1000.0, 2000.0);
        }


        // 创建盒子
        var mybox = viewer.entities.add({
            name: "mybox",
            id: "mybox",
            position: Cesium.Cartesian3.fromDegrees(108.3581, 22.7970, 5000),
            box: {
                //尺寸
                dimensions: new Cesium.Cartesian3(1000.0, 1000.0, 500.0),
                material: Cesium.Color.fromCssColorString("#007FFF").withAlpha(0.6),   //蓝色材质，不透明度 60%
                outline: true,
                outlineColor: Cesium.Color.WHITE
            },
            show: false,            //初始不显示
        });

        //依据线路飞行
        function funcFlyObj2() {

            //打开 viewer 视图调试 小工具
            //viewer.extend(Cesium.viewerCesiumInspectorMixin);
                  
            //mybox.show = true;
            
            //setTimeout("dispBox()",3*1000);

            
            //利用 property 随时间改变 BOX 大小
            var property = new Cesium.SampledProperty(Cesium.Cartesian3);

            //加入时间，和尺寸对象
            property.addSample(
                Cesium.JulianDate.fromDate(new Date()),
                new Cesium.Cartesian3(1000,1000,500)
            );
            

            property.addSample(
                Cesium.JulianDate.addSeconds(
                    Cesium.JulianDate.fromDate(new Date()), 3, new Cesium.JulianDate()
                ),
                new Cesium.Cartesian3(3000,3000,5000)
                
            );
            
            mybox.box.dimensions = property;
            
            viewer.entities.getById("mybox").show = true;   //显示

            //viewer.zoomTo(viewer.entities);   ////居中显示
            //viewer.trackedEntity = entity;

            //mybox.box.hierarchy = new CallBackProperty(function () {     );


        }


        //模拟飞行
        function funcFlyGame() {

        }

            viewer.camera.setView({
                destination: new Cesium.Cartesian3.fromDegrees(108.3581, 22.8059, 8000),
                orientation: {
                    heading: Cesium.Math.toRadians(0),  //镜头朝向 ，九十度，即东向   Radians 角度 0度是正北,镜头顺时针旋转九十度，即东向
                    pitch: Cesium.Math.toRadians(-75),   //镜头倾斜45度俯视，围绕Y轴旋转
                    roll: 0.0                             //围绕X轴旋转
                }
            }
            );

            let headingPitchRoll = new Cesium.HeadingPitchRoll();

            //初始位置
            let position = new Cesium.Cartesian3.fromDegrees(108.3581, 22.7970, 5000);
            //局部变换坐标系
            let fixedFrameTransform = Cesium.Transforms.localFrameToFixedFrameGenerator("north","west");

            //每次操作姿态变化 10度
            let deltaRadians = Cesium.Math.toRadians(10);

            //使用 primitive方式加载模型  ,为效率使用底层基本图元操作 primitive ，不使用 Entities 高层封装的api
            let airplaneModel = viewer.scene.primitives.add(
                Cesium.Model.fromGltf({
                    url: "SampleData/models/CesiumAir/Cesium_Air.glb",
                    scale: 3,
                    modelMatrrix: Cesium.Transforms.headingPitchRollToFixedFrame(
                        position,
                        headingPitchRoll,
                        Cesium.Ellipsoid.WGS84,
                        fixedFrameTransform
                    ),
                    minimumPixelSize: 180,
                    maximumScale: 15000,
                })
            )

            //添加键盘监听事件
            document.addEventListener("keydown", function (e) {
                switch (e.keyCode)
                {
                    //抬头
                    case 38:
                        headingPitchRoll.pitch += deltaRadians;
                        // 判断是否超过2π范围
                        if (headingPitchRoll.pitch > Cesium.Math.TWO_PI) {
                            headingPitchRoll.pitch -= Cesium.Math.TWO_PI;
                        }
                        console.log("抬头：pitch+");
                        break;
                    // 低头
                    case 40:
                        headingPitchRoll.pitch -= deltaRadians;
                        if (headingPitchRoll.pitch < -Cesium.Math.TWO_PI) {
                            headingPitchRoll.pitch += Cesium.Math.TWO_PI;
                        }
                        console.log("低头：pitch-");

                        break;

                    // 左转
                    case 37:
                        headingPitchRoll.heading -= deltaRadians;
                        // 判断是否超过2π范围
                        if (headingPitchRoll.heading < -Cesium.Math.TWO_PI) {
                            headingPitchRoll.heading += Cesium.Math.TWO_PI;
                        }
                        console.log("左转：heading+");
                        break;

                    // 右转
                    case 39:
                        headingPitchRoll.heading += deltaRadians;
                        // 判断是否超过2π范围
                        if (headingPitchRoll.heading > Cesium.Math.TWO_PI) {
                            headingPitchRoll.heading -= Cesium.Math.TWO_PI;
                        }
                        console.log("右转：heading-");
                        break;

                    // 顺时针
                    case 96:
                        headingPitchRoll.roll += deltaRadians;
                        // 判断是否超过2π范围
                        if (headingPitchRoll.roll > Cesium.Math.TWO_PI) {
                            headingPitchRoll.roll -= Cesium.Math.TWO_PI;
                        }
                        console.log("顺时针翻滚：roll+");
                        break;

                    // 逆时针
                    case 110:
                        headingPitchRoll.roll -= deltaRadians;
                        // 判断是否超过2π范围
                        if (headingPitchRoll.roll < -Cesium.Math.TWO_PI) {
                            headingPitchRoll.roll += Cesium.Math.TWO_PI;
                        }
                        console.log("逆时针翻滚：roll-");
                        break;

                    // 加速
                    case 107:
                        speed += 10
                        speed = Math.min(speed, 10000);
                        console.log("加速:" + speed);
                        break;
                    // 减速
                    case 109:
                        speed -= 10;
                        speed = Math.max(speed, 100);
                        console.log("减速:" + speed);

                    default:
                        break;
                }
            });

            //速度
            let speed = 120;

            //速度向量
            let speedVector = new Cesium.Cartesian3();
            // 飞行路径
            const pathPosition = new Cesium.SampledPositionProperty();
            const entityPath = viewer.entities.add({
                position: pathPosition,
                name: "飞行路径",
                path: {
                    show: true,
                    leadTime: 0,
                    trailTime: 60,
                    width: 20,
                    resolution: 1,
                    material: new Cesium.PolylineGlowMaterialProperty({
                        glowPower: 0.3,
                        taperPower: 0.3,
                        color: Cesium.Color.PALEGOLDENROD,
                    })
                }
            });


            // 渲染更新前阶段添加监听
            viewer.scene.preUpdate.addEventListener(() => {
                speedVector = Cesium.Cartesian3.multiplyByScalar(
                    Cesium.Cartesian3.UNIT_X,
                    speed / 10,
                    speedVector
                );
                position = Cesium.Matrix4.multiplyByPoint(
                    airplaneModel.modelMatrix,
                    speedVector,
                    position
                );
                // 将点添加到路径中
                pathPosition.addSample(Cesium.JulianDate.now(), position);

                // 更新模型姿态与位置
                Cesium.Transforms.headingPitchRollToFixedFrame(
                    position,
                    headingPitchRoll,
                    Cesium.Ellipsoid.WGS84,
                    fixedFrameTransform,
                    airplaneModel.modelMatrix
                )
            })
            
            
       



    </script>



</body>

</html>






